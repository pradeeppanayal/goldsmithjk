import{o as m,h as p,i as f,A as h,b as s,j as r,w as i,e as c,t as g,f as l,g as b}from"./index-16a40994.js";import{_ as v}from"./DynamicTable-e0065ba3.js";import{D as w}from"./DynamicDialog-5bc022d6.js";import{s as D,p as u}from"./dao-bd6f5c58.js";import{S,A as n,_ as A}from"./CAlert-53b8196f.js";const C={class:"pricing-header p-3 pb-md-4 mx-auto"},P={class:"row"},E=s("div",{class:"col"},[s("div",{class:"mb-3 row text-start"},[s("div",{class:"col-sm-10"},[s("span",{class:"display-6 fw-normal"},"Products")])])],-1),y={class:"col text-end"},I=s("span",{class:"material-icons"},"add",-1),M={class:"text-center"},O=s("div",{class:"spinner-grow",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),R={class:"d-flex d-flex p-3 border-top"},j={data:function(){return{showDialog:!1,selectedObject:null,dialogTitle:"Product info",items:[],fields:[],allowRowAction:!0,actionMapper:{},alertmode:"",alertmsg:"Saved",loadingmsg:"",searchword:""}},mounted:function(){this.loadFields(),this.loadProducts()},methods:{loadFields:function(){var t=this;D.getById(S.PRODUCT_SETTINGS).then(e=>{t.fields=e.fields??[]})},getActionsItems:function(t){var e=[{identifier:"editClick",materialicon:"edit",title:"Edit"}];return t.status==this.$statusLabelMapper.enabled&&e.push({identifier:"disableItem",materialicon:"visibility_off",title:"Disable"}),t.status==this.$statusLabelMapper.disabled&&e.push({identifier:"enableItem",materialicon:"visibility",title:"Enable"}),e},loadProducts:function(t){t&&t.preventDefault();var e=this,a={};e.loadingmsg="Fetching products...",u.list(e.searchword).then(o=>{_.each(o,function(d){a[d.id]=e.getActionsItems(d)}),e.items=o,e.actionMapper=a}).catch(o=>{console.log(o),e.alertmode=n.ERROR,e.alertmsg="Could not load the products"}).finally(()=>{e.loadingmsg=""})},enableProduct:function(t){this.updateStatus(t,this.$statusLabelMapper.enabled)},disableProduct:function(t){this.updateStatus(t,this.$statusLabelMapper.disabled)},updateStatus:function(t,e){t.status=e,this.performSave(t)},showEditDialog:function(t){this.selectedObject=t,this.showDialog=!0},showAddDialog:function(t){t&&t.preventDefault(),this.selectedObject=null,this.showDialog=!0},performSave:function(t){t.status=t.status??this.$statusLabelMapper.enabled;var e=this;e.showDialog=!1,e.loadingmsg="Saving customer info...",u.addOrUpdate(t).then(()=>{e.alertmode=n.SUCCESS,e.alertmsg="Changes saved",e.loadProducts()}).catch(a=>{console.log(a),e.alertmode=n.ERROR,e.alertmsg="Could not save the changes"}).finally(()=>{e.loadingmsg=""})}}},N=Object.assign(j,{__name:"Products",setup(t){return(e,a)=>(m(),p(h,null,{default:f(()=>[s("div",C,[s("div",P,[E,s("div",y,[s("button",{class:"btn btn-outline-success",onClick:a[0]||(a[0]=(...o)=>e.showAddDialog&&e.showAddDialog(...o))},[r(" Add"),I])])]),i(s("div",null,[s("div",M,[r(g(e.loadingmsg)+" ",1),O])],512),[[c,e.loadingmsg]]),i(s("div",null,[l(A,{msg:e.alertmsg,mode:e.alertmode},null,8,["msg","mode"]),s("form",R,[i(s("input",{class:"form-control me-2","onUpdate:modelValue":a[1]||(a[1]=o=>e.searchword=o),type:"search",placeholder:"Search","aria-label":"Search"},null,512),[[b,e.searchword]]),s("button",{class:"btn btn-outline-success",type:"submit",onClick:a[2]||(a[2]=(...o)=>e.loadProducts&&e.loadProducts(...o))},"Search")]),l(v,{items:e.items,columns:e.fields,allowaction:e.allowRowAction,actionmapper:e.actionMapper,actionmapperidentifier:"id",onDisableItem:e.disableProduct,onEnableItem:e.enableProduct,onEditClick:e.showEditDialog},null,8,["items","columns","allowaction","actionmapper","onDisableItem","onEnableItem","onEditClick"])],512),[[c,!e.loadingmsg]])]),l(w,{show:e.showDialog,fields:e.fields,title:e.dialogTitle,actualobj:e.selectedObject,onSave:e.performSave,onCancel:a[3]||(a[3]=o=>e.showDialog=!1)},null,8,["show","fields","title","actualobj","onSave"])]),_:1}))}});export{N as default};
