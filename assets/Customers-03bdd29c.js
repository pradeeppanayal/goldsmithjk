import{o as c,h as m,i as h,j as f,s as p,S as b,n as u,A as n,C as g,b as a,m as d,w as i,e as r,t as C,f as l,g as v,u as w}from"./index-fba89431.js";import{_ as S}from"./DynamicTable-0cf79a3b.js";import{D}from"./DynamicDialog-3a452edc.js";import{_ as y}from"./CAlert-5080164c.js";const A={class:"pricing-header p-3 pb-md-4 mx-auto"},E={class:"row"},M=a("div",{class:"col"},[a("div",{class:"mb-3 row text-start"},[a("div",{class:"col-sm-10"},[a("span",{class:"display-6 fw-normal"},"Customers")])])],-1),I={class:"col text-end"},O=a("span",{class:"material-icons"},"add",-1),B={class:"text-center"},j=a("div",{class:"spinner-grow",role:"status"},[a("span",{class:"visually-hidden"},"Loading...")],-1),L={class:"d-flex d-flex p-3 border-top"},N={data:function(){return{showDialog:!1,selectedObject:null,dialogTitle:"Customer info",items:[],fields:[],allowRowAction:!0,actionMapper:{},alertmode:"",alertmsg:"",loadingmsg:"",searchword:""}},mounted:function(){this.loadFields(),this.loadCustomers()},methods:{loadFields:function(){var e=this;p.getById(b.CUSTOMER_SETTINGS).then(s=>{e.fields=s.fields??[]})},getActionsItems:function(e){var s=[{identifier:"editClick",materialicon:"edit",title:"Edit"}];return e.status==this.$statusLabelMapper.enabled&&s.push({identifier:"disableItem",materialicon:"visibility_off",title:"Disable"}),e.status==this.$statusLabelMapper.disabled&&s.push({identifier:"enableItem",materialicon:"visibility",title:"Enable"}),s},enableCustomer:function(e){this.changeStatus(e,this.$statusLabelMapper.enabled)},disableCustomer:function(e){this.changeStatus(e,this.$statusLabelMapper.disabled)},changeStatus:function(e,s){e.status=s,this.performSave(e)},loadCustomers:function(e){e&&e.preventDefault();var s=this;s.loadingmsg="Fetching customer info...",s.loadCustomersSilently()},showAddDialog:function(e){e&&e.preventDefault(),this.selectedObject=null,this.showDialog=!0},loadCustomersSilently:function(){var e=this,s={};u.list(e.searchword).then(o=>{console.log(o),_.each(o,function(t){s[t.id]=e.getActionsItems(t),t["Cash Balance"]=(t.CashCredit??0)-(t.CashDebit??0),t["Gold Balance"]=(t.GoldCredit??0)-(t.GoldDebit??0),t["Cash Balance"]=Math.round((t["Cash Balance"]+Number.EPSILON)*100)/100,t["Gold Balance"]=Math.round((t["Gold Balance"]+Number.EPSILON)*100)/100}),e.items=o,e.actionMapper=s}).catch(o=>{console.log(o),e.alertmode=n.ERROR,e.alertmsg="Could not load the customers"}).finally(()=>{e.loadingmsg=""})},performSave:function(e){e.status=e.status??this.$statusLabelMapper.enabled;var s=this;s.showDialog=!1,g.showAlert(s,"Changes saved.",n.SUCCESS),s.loadCustomersSilently()},editEntry:function(e){this.selectedObject=e,this.showDialog=!0}}},R=Object.assign(N,{__name:"Customers",setup(e){return(s,o)=>(c(),m(f,null,{default:h(()=>[a("div",A,[a("div",E,[M,a("div",I,[a("button",{class:"btn btn-outline-success",onClick:o[0]||(o[0]=(...t)=>s.showAddDialog&&s.showAddDialog(...t))},[d(" Add"),O])])]),i(a("div",null,[a("div",B,[d(C(s.loadingmsg)+" ",1),j])],512),[[r,s.loadingmsg]]),i(a("div",null,[l(y,{msg:s.alertmsg,mode:s.alertmode},null,8,["msg","mode"]),a("form",L,[i(a("input",{class:"form-control me-2",type:"search",placeholder:"Search","onUpdate:modelValue":o[1]||(o[1]=t=>s.searchword=t),"aria-label":"Search"},null,512),[[v,s.searchword]]),a("button",{class:"btn btn-outline-success",type:"submit",onClick:o[2]||(o[2]=(...t)=>s.loadCustomers&&s.loadCustomers(...t))},"Search")]),l(S,{items:s.items,columns:s.fields,allowaction:s.allowRowAction,actionmapper:s.actionMapper,actionmapperidentifier:"id",onEditClick:s.editEntry,onDisableItem:s.disableCustomer,onEnableItem:s.enableCustomer},null,8,["items","columns","allowaction","actionmapper","onEditClick","onDisableItem","onEnableItem"])],512),[[r,!s.loadingmsg]])]),l(D,{show:s.showDialog,fields:s.fields,title:s.dialogTitle,actualobj:s.selectedObject,onSave:s.performSave,onCancel:o[3]||(o[3]=t=>s.showDialog=!1),dao:w(u)},null,8,["show","fields","title","actualobj","onSave","dao"])]),_:1}))}});export{R as default};
