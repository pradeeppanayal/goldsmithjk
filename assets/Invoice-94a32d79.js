import{w as m,v as R,o as l,c as r,F as k,r as P,t as h,a as p,b as t,_ as D,d as g,e as I,f as c,g as v,h as A,i as w,A as $,j as u,u as N}from"./index-8a337015.js";import{_ as O}from"./InvoiceItemTable-e996fe94.js";import{A as a,S as T}from"./ApplicationConstants-909446ca.js";import{_ as b}from"./CAlert-8d6317ac.js";import{p as E,s as V,r as M,C as y,I as U,i as B}from"./dao-0a59864c.js";import{_ as L}from"./CustomerPicker-1f382ab3.js";const j=t("option",{value:"0"},"Select an item",-1),F=["value"],G={props:["seleceted","show"],emits:["selected"],data:function(){return{products:[],items:[],placeholder:"Select a product",selectedproduct:null}},mounted:function(){this.loadProducts()},watch:{show:function(){this.show||(this.selectedproduct=0)},selectedproduct:function(){this.show&&this.itemSelected&&this.itemSelected(this.selectedproduct)}},methods:{loadProducts:function(){var s=this;E.list().then(e=>{s.products=e,s.items=_.map(e,function(o){return{id:o.id,text:o.Name}})})},itemSelected:function(s){if(!s){this.$emit("selected",{});return}var e=_.find(this.products,function(o){return o.id==s});console.log(s,e),this.$emit("selected",e)}}},q=Object.assign(G,{__name:"ProductPicker",setup(s){return(e,o)=>e.items?m((l(),r("select",{key:0,class:"form-control","onUpdate:modelValue":o[0]||(o[0]=n=>e.selectedproduct=n)},[j,(l(!0),r(k,null,P(e.items,n=>(l(),r("option",{value:n.id},h(n.text),9,F))),256))],512)),[[R,e.selectedproduct]]):p("",!0)}}),W={props:["show","item"],emits:["cancel","save"],data:function(){return{lockprice:!1,alertmode:"",alertmsg:""}},watch:{show:function(s){this.alertmode=this.alertmsg=""}},methods:{performClose:function(s){s&&s.preventDefault(),this.$emit("cancel")},performSave:function(s){if(s&&s.preventDefault(),this.alertmode=this.alertmsg="",!this.item||!this.item.productId){this.alertmode=a.ERROR,this.alertmsg="Select an item";return}if(!this.item.making||this.item.making<=0){this.alertmode=a.ERROR,this.alertmsg="Invalid making";return}if(!this.item.weight||this.item.weight<=0){this.alertmode=a.ERROR,this.alertmsg="Invalid weight";return}if(!this.item.purity||this.item.purity<=0){this.alertmode=a.ERROR,this.alertmsg="Invalid purity";return}this.$emit("save",this.item)},itemPicked:function(s){this.item.productId=s.id,this.item.name=s.Name,this.item.making=s["Making Amount"]}},components:{ProductPicker:q,CAlert:b}},z={class:"modal show",style:{display:"block"}},H={key:0,class:"modal-dialog"},J={class:"modal-content"},K={class:"modal-header"},Q=t("h5",{class:"modal-title",id:"staticBackdropLabel"},"Details",-1),X={class:"modal-body"},Y={class:"mb-3",style:{overflow:"visible"}},Z=t("label",{for:"exampleInputPassword1",class:"form-label"},"Item",-1),x={class:"mb-3"},ee=t("label",{for:"exampleInputPassword1",class:"form-label"},"Weight",-1),te={class:"mb-3"},se=t("label",{for:"exampleInputPassword1",class:"form-label"},"Purity",-1),oe={class:"mb-3"},ie=t("label",{for:"exampleInputPassword1",class:"form-label"},"Making/Gram",-1),ne={class:"modal-footer"},le={key:0,class:"modal-backdrop show"};function ae(s,e,o,n,f,d){const S=g("CAlert"),C=g("ProductPicker");return l(),r(k,null,[m(t("div",null,[t("div",z,[o.item?(l(),r("div",H,[t("div",J,[t("div",K,[Q,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[0]||(e[0]=(...i)=>d.performClose&&d.performClose(...i))})]),t("div",X,[c(S,{msg:s.alertmsg,mode:s.alertmode},null,8,["msg","mode"]),t("form",null,[t("div",Y,[Z,c(C,{onSelected:d.itemPicked,show:o.show},null,8,["onSelected","show"])]),t("div",x,[ee,m(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=i=>o.item.weight=i),class:"form-control"},null,512),[[v,o.item.weight]])]),t("div",te,[se,m(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=i=>o.item.purity=i),class:"form-control"},null,512),[[v,o.item.purity]])]),t("div",oe,[ie,m(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=i=>o.item.making=i),class:"form-control"},null,512),[[v,o.item.making]])])])]),t("div",ne,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=(...i)=>d.performClose&&d.performClose(...i))},"Close"),t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...i)=>d.performSave&&d.performSave(...i))},"Save")])])])):p("",!0)])],512),[[I,o.show]]),o.show?(l(),r("div",le)):p("",!0)],64)}const re=D(W,[["render",ae]]),de={class:"text-center"},ce=t("div",{class:"spinner-grow",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),me={key:0},ue={class:"pricing-header p-3 pb-md-4 mx-auto text-start"},he={class:"row"},fe={class:"col col-5"},ve={class:"display-10 fw-normal"},pe=t("div",{class:"col"},null,-1),_e={class:"col"},ge={class:"display-10 fw-normal"},Ie={class:"display-10 fw-normal"},be=t("hr",null,null,-1),we={class:"row"},ke={class:"col"},ye={class:"mb-3 row"},Se=t("label",{for:"staticEmail",class:"col-sm-2 col-form-label"},"Customer",-1),Ce={class:"col-sm-10"},Re={class:"col"},Pe={class:"d-grid gap-2 d-md-flex justify-content-md-end"},De=t("span",{class:"material-icons"},"save",-1),Ae={class:"d-grid gap-2 d-md-flex justify-content-md-end"},$e=t("span",{class:"material-icons"},"add",-1),Ne={key:1,class:"text-center p-5"},Oe={data:function(){return{showpicker:!1,currentItem:null,fractionDigits:3,invoiceInfo:{items:[],rate:123,customer:"Sample Customer",purchaseDate:"2023-04-27",invoiceNumber:"inv-123",vat:5},totals:[],updatecount:0,settings:{},alertmode:"",alertmsg:"",loadingmsg:"",totals:{}}},mounted:function(){this.loadInitialValues()},methods:{logTotals:function(s){this.totals=s},loadInitialValues:function(){var s=this;V.getById(T.APPLICATION_SETTINGS).then(e=>{s.settings=e}),M.getTodaysRate().then(e=>{s.invoiceInfo={items:[],rate:e,customer:"",purchaseDate:y.getNowAsMilliSeconds(),invoiceNumber:U.generateInvoiceNumber(),vat:s.settings.vat??5,totals:{}},s.updatecount=0})},showItemPicker:function(){this.currentItem={},this.showpicker=!0},itemSelected:function(s){this.invoiceInfo.items.push(s),console.log(s),this.updatecount+=1,this.showpicker=!1},saveInvoice:function(s){s&&s.preventDefault();var e=this;if(e.alertmsg="",e.alertmode="",!this.invoiceInfo.customer){e.alertmode=a.ERROR,e.alertmsg="Customer info required";return}if(!this.invoiceInfo.items||this.invoiceInfo.items.length==0){e.alertmode=a.ERROR,e.alertmsg="Minimum of 1 item need to added.";return}const o={...this.invoiceInfo};o.totals=this.totals,B.addOrUpdate(o).then(()=>{e.loadInitialValues(),e.alertmode=a.SUCCESS,e.alertmsg="Invoice saved."}).catch(n=>{console.log(n),e.alertmode=a.ERROR,e.alertmsg="Could not save the invoice"}).finally(()=>{e.loadingmsg=""})},deleteItem:function(s){this.invoiceInfo.items=_.filter(this.invoiceInfo.items,function(e){return e!=s}),this.updatecount+=1},customerSelected:function(s){this.invoiceInfo.customer=s.Name,this.invoiceInfo.customerId=s.id}},components:{CAlert:b}},Le=Object.assign(Oe,{__name:"Invoice",setup(s){return(e,o)=>{const n=g("RouterLink");return l(),A($,null,{default:w(()=>[m(t("div",null,[t("div",de,[u(h(e.loadingmsg)+" ",1),ce])],512),[[I,e.loadingmsg]]),m(t("div",null,[e.invoiceInfo&&e.invoiceInfo.rate?(l(),r("div",me,[t("div",ue,[t("div",he,[t("div",fe,[t("h3",ve,"Invoice : "+h(e.invoiceInfo.invoiceNumber),1)]),pe,t("div",_e,[t("h3",ge,"Date : "+h(N(y).getAsFormattedDate(e.invoiceInfo.purchaseDate)),1),t("h3",Ie,"Rate : "+h(e.invoiceInfo.rate)+" "+h(e.settings.currency),1)])]),be,c(b,{msg:e.alertmsg,mode:e.alertmode},null,8,["msg","mode"]),t("div",we,[t("div",ke,[t("div",ye,[Se,t("div",Ce,[c(L,{onSelected:e.customerSelected},null,8,["onSelected"])])])]),t("div",Re,[t("div",Pe,[t("button",{class:"btn btn-outline-success",onClick:o[0]||(o[0]=(...f)=>e.saveInvoice&&e.saveInvoice(...f))},[u("Save Invoice"),De])])]),t("div",Ae,[t("button",{class:"btn btn-outline-success",onClick:o[1]||(o[1]=(...f)=>e.showItemPicker&&e.showItemPicker(...f))},[u("Add"),$e])])])]),c(O,{invoiceinfo:e.invoiceInfo,fraction_digits:e.fractionDigits,allowdelete:"true",updatecount:e.updatecount,onRowdelete:e.deleteItem,onTotals:e.logTotals},null,8,["invoiceinfo","fraction_digits","updatecount","onRowdelete","onTotals"]),c(re,{show:e.showpicker,item:e.currentItem,onCancel:o[2]||(o[2]=f=>e.showpicker=!1),onSave:e.itemSelected},null,8,["show","item","onSave"])])):(l(),r("div",Ne,[u(" No rate available for the Today. Please "),c(n,{to:"/rates"},{default:w(()=>[u("set the rate")]),_:1}),u(" . ")]))],512),[[I,!e.loadingmsg]])]),_:1})}}});export{Le as default};
