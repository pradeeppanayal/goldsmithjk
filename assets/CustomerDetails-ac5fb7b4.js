import{o as i,c as l,b as e,F as T,r as k,t as o,h as p,i as A,j as w,l as b,A as h,y as D,z as N,n as I,f as m,w as c,e as u,a as g,u as d,D as f,m as r,C as v,B as L}from"./index-b25e6acc.js";import{_ as O}from"./CAlert-5fafc70e.js";import{_ as C}from"./DynamicTable-5e5a502c.js";const R={key:0,class:"table"},S=e("thead",null,null,-1),B={key:1},G=e("div",{class:"text-center display-10"},"No data to show",-1),$=[G],M={props:["items"],emits:[],methods:{}},U=Object.assign(M,{__name:"TwoColumnTable",setup(s){return(t,n)=>s.items&&s.items.length>0?(i(),l("table",R,[S,e("tbody",null,[(i(!0),l(T,null,k(s.items,a=>(i(),l("tr",null,[e("th",null,o(a.key),1),e("td",null,o(a.value),1)]))),256))])])):(i(),l("div",B,$))}}),E={class:"pricing-header p-3 pb-md-4 mx-auto"},V=e("div",{class:"row"},[e("div",{class:"col"},[e("div",{class:"mb-3 row text-start"},[e("div",{class:"col-sm-10"},[e("span",{class:"display-6 fw-normal"},"Customer Details")])])])],-1),F={class:"nav nav-tabs"},P={class:"nav-item"},j=["onClick"],W=e("br",null,null,-1),z={class:"tab-content"},H={key:0,class:"row"},q={class:"col text-start"},J={class:"col"},K={class:"col"},Q={key:0,class:"row"},X={class:"col text-start"},Y={class:"col"},Z={key:0,class:"row"},x={class:"col text-start"},tt={class:"col"},st={class:"text-center"},et=e("div",{class:"spinner-grow",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),at={data:function(){return{currentUserId:null,alertmode:"",alertmsg:"",loadingmsg:"",formattedCustomerDetails:null,selectedmenuitem:"details",tabs:[{title:"Details",identifier:"details"},{title:"Invoices",identifier:"invoices"},{title:"Gold Transactions",identifier:"gold"},{title:"Cash Transactions",identifier:"cash"}],invoices:null,actions:[{identifier:"viewClick",materialicon:"print",title:"View and Print Invoice"}],goldTransactions:null,cashTransactions:null,totals:{},actionMapper:[]}},mounted:function(){this.currentUserId=this.$route.params.customerid,this.checkAndLoadInfo()},methods:{getTotal:function(s,t){return s.reduce((n,a)=>n+a[t],0)},showTab:function(s,t){s&&s.preventDefault(),this.selectedmenuitem=t,this.selectedmenuitem=="invoices"&&this.checkAndLoadInvoices(),this.selectedmenuitem=="cash"&&this.checkAndLoadCashTransactions(),this.selectedmenuitem=="gold"&&this.checkAndLoadGoldTransactions()},checkAndLoadInvoices:function(){if(!this.invoices){var s=this,t={};s.loadingmsg="Loading invoices...",s.totals={weight:0,amount:0},b.listByCustomer(s.currentUserId).then(n=>{_.each(n,function(a){t[a.invoiceNumber]=s.actions,a.products=a.items.length,a.weight=a.totals?a.totals.weight:0,a.amount=a.totals?a.totals.totalAmount:0,a.weight&&a.amount&&(s.totals.weight+=a.weight,s.totals.amount+=a.amount)}),s.actionMapper=t,s.invoices=n}).catch(n=>{console.log(n),s.alertmode=h.ERROR,s.alertmsg="Could not load the invoices "}).finally(()=>{s.loadingmsg=""})}},showInvoiceReport:function(s){var t=this.$basedomainname+"invoices/"+s.invoiceNumber;window.open(t,"_blank")},checkAndLoadCashTransactions:function(){if(!this.cashTransactions){var s=this;s.loadingmsg="Loading cash transactions...",D.listByCustomer(this.currentUserId).then(t=>s.cashTransactions=t).catch(t=>{console.log(t),s.alertmode=h.ERROR,s.alertmsg="Could not load the cash transactions "}).finally(()=>{s.loadingmsg=""})}},checkAndLoadGoldTransactions:function(){if(!this.goldTransactions){var s=this;s.loadingmsg="Loading gold transactions...",N.listByCustomer(this.currentUserId).then(t=>{_.each(t,n=>n.pureWeight=n.weight*n.purity*.001),s.goldTransactions=t}).catch(t=>{console.log(t),s.alertmode=h.ERROR,s.alertmsg="Could not load the gold transactions "}).finally(()=>{s.loadingmsg=""})}},checkAndLoadInfo:function(){var s=this;I.getById(this.currentUserId).then(t=>{s.formatCustomerDeatils(t)}).catch(t=>{console.log(t),s.alertmode=h.ERROR,s.alertmsg="Could not load the customers"}).finally(()=>{s.loadingmsg=""})},formatCustomerDeatils:function(s){var t={};t=[{key:"Name",value:s.Name},{key:"Contact",value:s.Contact},{key:"Address",value:s.Address},{key:"Status",value:s.status},{key:"CashCredit",value:s.CashCredit},{key:"CashDebit",value:s.CashDebit},{key:"Cash Balance",value:Math.round(((s.CashCredit??0)-(s.CashDebit??0)+Number.EPSILON)*100)/100},{key:"GoldCredit",value:s.GoldCredit},{key:"GoldDebit",value:s.GoldDebit},{key:"Gold Balance",value:Math.round(((s.GoldCredit??0)-(s.GoldDebit??0)+Number.EPSILON)*100)/100}],this.formattedCustomerDetails=t}}},lt=Object.assign(at,{__name:"CustomerDetails",setup(s){return(t,n)=>(i(),p(w,null,{default:A(()=>[e("div",E,[V,e("div",null,[m(O,{msg:t.alertmsg,mode:t.alertmode},null,8,["msg","mode"]),e("ul",F,[(i(!0),l(T,null,k(t.tabs,a=>(i(),l("li",P,[e("a",{class:L(["nav-link",t.selectedmenuitem==a.identifier?"active":""]),onClick:y=>t.showTab(y,a.identifier),"aria-current":"page",href:"#"},o(a.title),11,j)]))),256))])]),W,e("div",z,[c(e("div",null,[t.formattedCustomerDetails?(i(),p(U,{key:0,items:t.formattedCustomerDetails},null,8,["items"])):g("",!0)],512),[[u,!t.loadingmsg&&t.selectedmenuitem=="details"]]),c(e("div",null,[m(C,{onViewClick:t.showInvoiceReport,items:t.invoices,columns:d(f).INVOICES_COLUMNS,allowaction:"true",actionmapper:t.actionMapper,actionmapperidentifier:"invoiceNumber"},null,8,["onViewClick","items","columns","actionmapper"]),t.invoices&&t.invoices.length>0?(i(),l("div",H,[e("div",q,[e("strong",null,o(t.invoices.length),1),r(" record(s).")]),e("div",J,[r("Total Weight:"),e("strong",null,o(d(v).getAsFormattedAmount(t.totals.weight)),1)]),e("div",K,[r("Total Amount: "),e("strong",null,o(d(v).getAsFormattedAmount(t.totals.amount)),1)])])):g("",!0)],512),[[u,!t.loadingmsg&&t.selectedmenuitem=="invoices"]]),c(e("div",null,[m(C,{items:t.cashTransactions,columns:d(f).CASH_TRANSACTION_COLUMNS},null,8,["items","columns"]),t.cashTransactions&&t.cashTransactions.length>0?(i(),l("div",Q,[e("div",X,[e("strong",null,o(t.cashTransactions.length),1),r(" record(s).")]),e("div",Y,[r("Total Amount: "),e("strong",null,o(d(v).getAsFormattedAmount(t.getTotal(t.cashTransactions,"amount"))),1)])])):g("",!0)],512),[[u,!t.loadingmsg&&t.selectedmenuitem=="cash"&&t.cashTransactions]]),c(e("div",null,[m(C,{items:t.goldTransactions,columns:d(f).GOLD_TRANSACTION_COLUMNS},null,8,["items","columns"]),t.goldTransactions&&t.goldTransactions.length>0?(i(),l("div",Z,[e("div",x,[e("strong",null,o(t.goldTransactions.length),1),r(" record(s).")]),e("div",tt,[r("Total Amount: "),e("strong",null,o(d(v).getAsFormattedAmount(t.getTotal(t.goldTransactions,"pureWeight"))),1)])])):g("",!0)],512),[[u,!t.loadingmsg&&t.selectedmenuitem=="gold"&&t.goldTransactions]]),c(e("div",null,[e("div",st,[r(o(t.loadingmsg)+" ",1),et])],512),[[u,t.loadingmsg]])])])]),_:1}))}});export{lt as default};
