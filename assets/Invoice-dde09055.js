import{w as u,v as R,o as a,c,F as y,r as P,t as f,a as g,b as t,p as A,_ as D,C as n,A as r,d as w,e as I,f as m,g as p,h as $,i as k,j as N,s as O,S as T,k as E,I as V,l as M,m as h,u as U}from"./index-6619cc03.js";import{_ as B}from"./InvoiceItemTable-b83711a5.js";import{_ as b}from"./CAlert-b391320e.js";import{_ as L}from"./CustomerPicker-fbc1604e.js";const j=t("option",{value:"0"},"Select an item",-1),F=["value"],G={props:["seleceted","show"],emits:["selected"],data:function(){return{products:[],items:[],placeholder:"Select a product",selectedproduct:null}},mounted:function(){this.loadProducts()},watch:{show:function(){this.show||(this.selectedproduct=0)},selectedproduct:function(){this.show&&this.itemSelected&&this.itemSelected(this.selectedproduct)}},methods:{loadProducts:function(){var s=this;A.list().then(e=>{s.products=e,s.items=_.map(e,function(o){return{id:o.id,text:o.Name}})})},itemSelected:function(s){if(!s){this.$emit("selected",{});return}var e=_.find(this.products,function(o){return o.id==s});console.log(s,e),this.$emit("selected",e)}}},q=Object.assign(G,{__name:"ProductPicker",setup(s){return(e,o)=>e.items?u((a(),c("select",{key:0,class:"form-control","onUpdate:modelValue":o[0]||(o[0]=l=>e.selectedproduct=l)},[j,(a(!0),c(y,null,P(e.items,l=>(a(),c("option",{value:l.id},f(l.text),9,F))),256))],512)),[[R,e.selectedproduct]]):g("",!0)}}),W={props:["show","item"],emits:["cancel","save"],data:function(){return{lockprice:!1,alertmode:"",alertmsg:""}},watch:{show:function(s){this.alertmode=this.alertmsg=""}},methods:{performClose:function(s){s&&s.preventDefault(),this.$emit("cancel")},performSave:function(s){s&&s.preventDefault();var e=this;if(this.alertmode=this.alertmsg="",!this.item||!this.item.productId){n.showAlert(e,"Select an item",r.ERROR);return}if(!this.item.making||this.item.making<=0){n.showAlert(e,"Invalid making",r.ERROR);return}if(!this.item.weight||this.item.weight<=0){n.showAlert(e,"Invalid weight",r.ERROR);return}if(!this.item.purity||this.item.purity<=0){n.showAlert(e,"Invalid purity",r.ERROR);return}this.$emit("save",this.item)},itemPicked:function(s){this.item.productId=s.id,this.item.name=s.Name,this.item.making=s["Making Amount"]}},components:{ProductPicker:q,CAlert:b}},z={class:"modal show",style:{display:"block"}},H={key:0,class:"modal-dialog"},J={class:"modal-content"},K={class:"modal-header"},Q=t("h5",{class:"modal-title",id:"staticBackdropLabel"},"Details",-1),X={class:"modal-body"},Y={class:"mb-3",style:{overflow:"visible"}},Z=t("label",{for:"exampleInputPassword1",class:"form-label"},"Item",-1),x={class:"mb-3"},ee=t("label",{for:"exampleInputPassword1",class:"form-label"},"Weight",-1),te={class:"mb-3"},se=t("label",{for:"exampleInputPassword1",class:"form-label"},"Purity",-1),oe={class:"mb-3"},ie=t("label",{for:"exampleInputPassword1",class:"form-label"},"Making/Gram",-1),ne={class:"modal-footer"},le={key:0,class:"modal-backdrop show"};function ae(s,e,o,l,v,d){const S=w("CAlert"),C=w("ProductPicker");return a(),c(y,null,[u(t("div",null,[t("div",z,[o.item?(a(),c("div",H,[t("div",J,[t("div",K,[Q,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[0]||(e[0]=(...i)=>d.performClose&&d.performClose(...i))})]),t("div",X,[m(S,{msg:s.alertmsg,mode:s.alertmode},null,8,["msg","mode"]),t("form",null,[t("div",Y,[Z,m(C,{onSelected:d.itemPicked,show:o.show},null,8,["onSelected","show"])]),t("div",x,[ee,u(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=i=>o.item.weight=i),class:"form-control"},null,512),[[p,o.item.weight]])]),t("div",te,[se,u(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=i=>o.item.purity=i),class:"form-control"},null,512),[[p,o.item.purity]])]),t("div",oe,[ie,u(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=i=>o.item.making=i),class:"form-control"},null,512),[[p,o.item.making]])])])]),t("div",ne,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=(...i)=>d.performClose&&d.performClose(...i))},"Close"),t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...i)=>d.performSave&&d.performSave(...i))},"Save")])])])):g("",!0)])],512),[[I,o.show]]),o.show?(a(),c("div",le)):g("",!0)],64)}const re=D(W,[["render",ae]]),ce={class:"text-center"},de=t("div",{class:"spinner-grow",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),me={key:0},ue={class:"pricing-header p-3 pb-md-4 mx-auto text-start"},he={class:"row"},fe={class:"col col-5"},ve={class:"display-10 fw-normal"},pe=t("div",{class:"col"},null,-1),_e={class:"col"},ge={class:"display-10 fw-normal"},we={class:"display-10 fw-normal"},Ie=t("hr",null,null,-1),be={class:"row"},ke={class:"col"},ye={class:"mb-3 row"},Se=t("label",{for:"staticEmail",class:"col-sm-2 col-form-label"},"Customer",-1),Ce={class:"col-sm-10"},Re={class:"col"},Pe={class:"d-grid gap-2 d-md-flex justify-content-md-end"},Ae=t("span",{class:"material-icons"},"save",-1),De={class:"d-grid gap-2 d-md-flex justify-content-md-end"},$e=t("span",{class:"material-icons"},"add",-1),Ne={key:1,class:"text-center p-5"},Oe={data:function(){return{showpicker:!1,currentItem:null,fractionDigits:3,invoiceInfo:{items:[],rate:123,customer:"Sample Customer",purchaseDate:"2023-04-27",invoiceNumber:"inv-123",vat:5},totals:[],updatecount:0,settings:{},alertmode:"",alertmsg:"",loadingmsg:"",totals:{}}},mounted:function(){this.loadInitialValues()},methods:{logTotals:function(s){this.totals=s},loadInitialValues:function(){var s=this;O.getById(T.APPLICATION_SETTINGS).then(e=>{s.settings=e}),E.getTodaysRate().then(e=>{s.invoiceInfo={items:[],rate:e,customer:"",purchaseDate:n.getNowAsMilliSeconds(),invoiceNumber:V.generateInvoiceNumber(),vat:s.settings.vat??5,totals:{}},s.updatecount=0})},showItemPicker:function(){this.currentItem={},this.showpicker=!0},itemSelected:function(s){this.invoiceInfo.items.push(s),console.log(s),this.updatecount+=1,this.showpicker=!1},saveInvoice:function(s){s&&s.preventDefault();var e=this;if(!this.invoiceInfo.customer){n.showAlert(e,"Customer info required.",r.ERROR);return}if(!this.invoiceInfo.items||this.invoiceInfo.items.length==0){n.showAlert(e,"Minimum of 1 item required.",r.ERROR);return}const o={...this.invoiceInfo};o.totals=this.totals,M.addOrUpdate(o).then(()=>{n.showAlert(e,"Invoice saved",r.SUCCESS),e.loadInitialValues(),e.showInvoiceToPrint(o.invoiceNumber)}).catch(l=>{console.log(l),n.showAlert(e,"Could not save the invoice.",r.ERROR)}).finally(()=>{e.loadingmsg=""})},deleteItem:function(s){this.invoiceInfo.items=_.filter(this.invoiceInfo.items,function(e){return e!=s}),this.updatecount+=1},customerSelected:function(s){this.invoiceInfo.customer=s.Name,this.invoiceInfo.customerId=s.id},showInvoiceToPrint(s){var e=this.$basedomainname+"invoices/"+s;window.open(e,"_blank")}},components:{CAlert:b}},Ue=Object.assign(Oe,{__name:"Invoice",setup(s){return(e,o)=>{const l=w("RouterLink");return a(),$(N,null,{default:k(()=>[u(t("div",null,[t("div",ce,[h(f(e.loadingmsg)+" ",1),de])],512),[[I,e.loadingmsg]]),u(t("div",null,[e.invoiceInfo&&e.invoiceInfo.rate?(a(),c("div",me,[t("div",ue,[t("div",he,[t("div",fe,[t("h3",ve,"Invoice : "+f(e.invoiceInfo.invoiceNumber),1)]),pe,t("div",_e,[t("h3",ge,"Date : "+f(U(n).getAsFormattedDate(e.invoiceInfo.purchaseDate)),1),t("h3",we,"Rate : "+f(e.invoiceInfo.rate)+" "+f(e.settings.currency),1)])]),Ie,m(b,{msg:e.alertmsg,mode:e.alertmode},null,8,["msg","mode"]),t("div",be,[t("div",ke,[t("div",ye,[Se,t("div",Ce,[m(L,{onSelected:e.customerSelected},null,8,["onSelected"])])])]),t("div",Re,[t("div",Pe,[t("button",{class:"btn btn-outline-success",onClick:o[0]||(o[0]=(...v)=>e.saveInvoice&&e.saveInvoice(...v))},[h("Save Invoice"),Ae])])]),t("div",De,[t("button",{class:"btn btn-outline-success",onClick:o[1]||(o[1]=(...v)=>e.showItemPicker&&e.showItemPicker(...v))},[h("Add"),$e])])])]),m(B,{invoiceinfo:e.invoiceInfo,fraction_digits:e.fractionDigits,allowdelete:"true",updatecount:e.updatecount,onRowdelete:e.deleteItem,onTotals:e.logTotals},null,8,["invoiceinfo","fraction_digits","updatecount","onRowdelete","onTotals"]),m(re,{show:e.showpicker,item:e.currentItem,onCancel:o[2]||(o[2]=v=>e.showpicker=!1),onSave:e.itemSelected},null,8,["show","item","onSave"])])):(a(),c("div",Ne,[h(" No rate available for the Today. Please "),m(l,{to:"/rates"},{default:k(()=>[h("set the rate")]),_:1}),h(" . ")]))],512),[[I,!e.loadingmsg]])]),_:1})}}});export{Ue as default};
