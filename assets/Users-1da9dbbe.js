import{_ as M,E as b,A as u,n as U,d as k,o as l,c as r,w as d,e as m,b as t,f as c,F as v,r as S,G as O,t as p,a as h,h as w,i as E,j as $,x as R,H as g,C as I,m as C,u as y,D as j}from"./index-00e45d0b.js";import{_ as L}from"./DynamicTable-62835890.js";import{D as P}from"./DynamicDialog-233dd02e.js";import{_ as f}from"./CAlert-b221f23b.js";const N={props:["show","user"],emits:["cancel","save"],data:function(){return{loading:!1,alertmsg:"",alertmode:"",userId:null,customers:[],mappings:[]}},mounted:function(){this.loadCustomers()},watch:{user:function(){this.mappings=[],this.loadMappings()},show:function(){this.show&&(this.mappings=[],this.loadMappings())}},methods:{loadMappings:function(){var s=this;!this.user||!this.user.id||(s.loading=!0,b.list(s.user.id).then(e=>{s.mappings=s.prepareMapping(e)}).catch(e=>{console.log(e),s.alertmode=u.ERROR,s.alertmsg="Could not load the customers"}).finally(()=>{s.loading=!1}))},prepareMapping:function(s){var e=[];return _.each(this.customers,function(i){e.push({customer:i,allowed:s.includes(i.id)})}),e},loadCustomers:function(){var s=this;U.list(s.searchword,!1,!0).then(e=>{s.customers=e}).catch(e=>{console.log(e),s.alertmode=u.ERROR,s.alertmsg="Could not load the customers"}).finally(()=>{s.loading=!1})},performClose:function(s){s&&s.preventDefault(),!this.loading&&this.$emit("cancel")},performSave:function(s){const e=[];_.each(this.mappings,function(a){a.allowed&&e.push(a.customer.id)});var i=this;b.addOrUpdate(i.user.id,e).then(a=>{i.$emit("save")}).catch(a=>{console.log(a),i.alertmode=u.ERROR,i.alertmsg="Could not save the changes."}).finally(()=>{i.loading=!1})}},components:{CAlert:f}},q={class:"modal show",style:{display:"block"}},V={class:"modal-dialog"},B={class:"modal-content"},T={class:"modal-header"},F=t("h5",{class:"modal-title",id:"staticBackdropLabel"},"Customer Mapping",-1),z={class:"modal-body",style:{"max-height":"500px",overflow:"auto"}},G={key:0,class:"table"},H=t("thead",null,null,-1),Y=["onUpdate:modelValue"],J={class:"modal-footer"},K=["disabled"],Q=["disabled"],W={key:0,class:"modal-backdrop show"};function X(s,e,i,a,ne,n){const D=k("CAlert");return l(),r(v,null,[d(t("div",null,[t("div",q,[t("div",V,[t("div",B,[t("div",T,[F,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[0]||(e[0]=(...o)=>n.performClose&&n.performClose(...o))})]),t("div",z,[c(D,{msg:s.alertmsg,mode:s.alertmode},null,8,["msg","mode"]),s.mappings&&s.mappings.length>0?(l(),r("table",G,[H,t("tbody",null,[(l(!0),r(v,null,S(s.mappings,o=>(l(),r("tr",null,[t("th",null,[d(t("input",{type:"checkbox","onUpdate:modelValue":A=>o.allowed=A},null,8,Y),[[O,o.allowed]])]),t("td",null,p(o.customer.Name),1)]))),256))])])):h("",!0)]),t("div",J,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[1]||(e[1]=(...o)=>n.performClose&&n.performClose(...o)),disabled:s.loading},"Close",8,K),t("button",{type:"button",class:"btn btn-primary",onClick:e[2]||(e[2]=(...o)=>n.performSave&&n.performSave(...o)),disabled:s.loading},p(s.loading?"Saving...":"Save"),9,Q)])])])])],512),[[m,i.show]]),i.show?(l(),r("div",W)):h("",!0)],64)}const Z=M(N,[["render",X]]),x={class:"pricing-header p-3 pb-md-4 mx-auto"},ee={class:"row border-bottom"},se=t("div",{class:"col"},[t("div",{class:"mb-3 row text-start"},[t("div",{class:"col-sm-10"},[t("span",{class:"display-6 fw-normal"},"Users")])])],-1),te={class:"col text-end"},ie=t("span",{class:"material-icons"},"add",-1),ae={class:"text-center"},oe=t("div",{class:"spinner-grow",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),le={data:function(){return{showDialog:!1,selectedObject:null,dialogTitle:"User info",items:[],showUserMapping:!1,inputfields:[{name:"Name",show:!0,type:"string",required:!0},{name:"Email",show:!0,type:"string",required:!0},{name:"Contact",show:!0,type:"number",required:!0},{name:"Password",show:!0,type:"string",required:!0}],editinputfields:[{name:"Name",show:!0,type:"string",required:!0},{name:"Contact",show:!0,type:"number",required:!0}],allowRowAction:!0,actionMapper:{},alertmode:"",alertmsg:"",loadingmsg:"",hasAdminPrivillage:!1}},mounted:function(){this.checkPrivillage()},methods:{checkPrivillage:function(){var s=this;this.hasAdminPrivillage=R.getCurrentUser().email==this.$adminMailId,console.log(this.hasAdminPrivillage),this.hasAdminPrivillage&&s.loadUsers()},getActionsItems:function(s){var e=[{identifier:"editClick",materialicon:"edit",title:"Edit"}];return s.Status==this.$statusLabelMapper.enabled&&e.push({identifier:"disableItem",materialicon:"visibility_off",title:"Disable"}),s.Status==this.$statusLabelMapper.disabled&&e.push({identifier:"enableItem",materialicon:"visibility",title:"Enable"}),e},disableUser:function(s){this.setStatus(s,this.$statusLabelMapper.disabled)},enableUser:function(s){this.setStatus(s,this.$statusLabelMapper.enabled)},setStatus:function(s,e){s.status=e,g.addOrUpdate(s),this.loadUsers()},showSettings:function(s){this.selectedObject=s,this.showUserMapping=!0},showEditUserDialog:function(s){this.selectedObject=s,this.showDialog=!0},loadUsers:function(){this.items=[];var s=this;s.loadingmsg="Fetching user details...";var e={};g.list().then(i=>{_.each(i,function(a){e[a.id]=s.getActionsItems(a)}),s.actionMapper=e,s.items=i}).catch(i=>{console.log(i),I.showAlert(s,"Could not fetch the users",u.ERROR)}).finally(()=>{s.loadingmsg=""})},getActionsItems:function(s){var e=[{identifier:"editClick",materialicon:"edit",title:"Edit"}];return s.status==this.$statusLabelMapper.enabled&&e.push({identifier:"disableItem",materialicon:"visibility_off",title:"Disable"}),s.status==this.$statusLabelMapper.disabled&&e.push({identifier:"enableItem",materialicon:"visibility",title:"Enable"}),e.push({identifier:"settingsClick",materialicon:"settings",title:"Settings"}),e},showAddDialog:function(s){s&&s.preventDefault(),this.selectedObject=null,this.showDialog=!0},performSave:function(s){var e=this;e.showDialog=!1,e.loadUsers()},editEntry:function(s){this.selectedObject=s,this.showDialog=!0}},components:{CAlert:f}},ce=Object.assign(le,{__name:"Users",setup(s){return(e,i)=>(l(),w($,null,{default:E(()=>[t("div",x,[t("div",ee,[se,t("div",te,[e.hasAdminPrivillage?(l(),r("button",{key:0,class:"btn btn-outline-success",onClick:i[0]||(i[0]=(...a)=>e.showAddDialog&&e.showAddDialog(...a))},[C(" Add"),ie])):h("",!0)])]),c(f,{msg:e.alertmsg,mode:e.alertmode},null,8,["msg","mode"]),d(t("div",null,[t("div",ae,[C(p(e.loadingmsg)+" ",1),oe])],512),[[m,e.loadingmsg]]),e.hasAdminPrivillage?d((l(),w(L,{key:0,allowaction:e.allowRowAction,items:e.items,columns:y(j).USER_COLUMNS,actionmapper:e.actionMapper,actionmapperidentifier:"id",onEditClick:e.showEditUserDialog,onDisableItem:e.disableUser,onEnableItem:e.enableUser,onSettingsClick:e.showSettings},null,8,["allowaction","items","columns","actionmapper","onEditClick","onDisableItem","onEnableItem","onSettingsClick"])),[[m,!e.loadingmsg]]):h("",!0)]),d(t("div",null," You are not authorized to access this page. ",512),[[m,!e.hasAdminPrivillage]]),c(P,{show:e.showDialog,fields:e.selectedObject?e.editinputfields:e.inputfields,title:e.dialogTitle,actualobj:e.selectedObject,onSave:e.performSave,onCancel:i[1]||(i[1]=a=>e.showDialog=!1),dao:y(g)},null,8,["show","fields","title","actualobj","onSave","dao"]),c(Z,{show:e.showUserMapping,user:e.selectedObject,onCancel:i[2]||(i[2]=a=>e.showUserMapping=!1),onSave:i[3]||(i[3]=a=>e.showUserMapping=!1)},null,8,["show","user"])]),_:1}))}});export{ce as default};
