import{o as f,h as m,i as p,A as h,b as e,j as n,w as i,e as d,t as g,f as l,g as b,u as w}from"./index-958b044c.js";import{_ as v}from"./DynamicTable-8f2cd1f3.js";import{D as S}from"./DynamicDialog-18d52cc1.js";import{s as D,S as A,p as u,C as r,A as c,_ as P}from"./dao-7357b694.js";const C={class:"pricing-header p-3 pb-md-4 mx-auto"},y={class:"row"},E=e("div",{class:"col"},[e("div",{class:"mb-3 row text-start"},[e("div",{class:"col-sm-10"},[e("span",{class:"display-6 fw-normal"},"Products")])])],-1),I={class:"col text-end"},M=e("span",{class:"material-icons"},"add",-1),O={class:"text-center"},j=e("div",{class:"spinner-grow",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),T={class:"d-flex d-flex p-3 border-top"},$={data:function(){return{showDialog:!1,selectedObject:null,dialogTitle:"Product info",items:[],fields:[],allowRowAction:!0,actionMapper:{},alertmode:"",alertmsg:"Saved",loadingmsg:"",searchword:""}},mounted:function(){this.loadFields(),this.loadProducts()},methods:{loadFields:function(){var s=this;D.getById(A.PRODUCT_SETTINGS).then(t=>{s.fields=t.fields??[]})},getActionsItems:function(s){var t=[{identifier:"editClick",materialicon:"edit",title:"Edit"}];return s.status==this.$statusLabelMapper.enabled&&t.push({identifier:"disableItem",materialicon:"visibility_off",title:"Disable"}),s.status==this.$statusLabelMapper.disabled&&t.push({identifier:"enableItem",materialicon:"visibility",title:"Enable"}),t},loadProducts:function(s){s&&s.preventDefault();var t=this;t.loadingmsg="Fetching products...",t.loadProductsSilently()},enableProduct:function(s){this.updateStatus(s,this.$statusLabelMapper.enabled)},disableProduct:function(s){this.updateStatus(s,this.$statusLabelMapper.disabled)},updateStatus:function(s,t){s.status=t,this.performSave(s)},showEditDialog:function(s){this.selectedObject=s,this.showDialog=!0},showAddDialog:function(s){s&&s.preventDefault(),this.selectedObject=null,this.showDialog=!0},loadProductsSilently:function(){var s={},t=this;u.list(t.searchword).then(a=>{_.each(a,function(o){s[o.id]=t.getActionsItems(o)}),t.items=a,t.actionMapper=s}).catch(a=>{console.log(a),r.showAlert(t,"Could not fetch the product info.",c.ERROR)}).finally(()=>{t.loadingmsg=""})},performSave:function(s){s.status=s.status??this.$statusLabelMapper.enabled;var t=this;t.showDialog=!1,r.showAlert(t,"Changes saved.",c.SUCCESS),t.loadProductsSilently()}}},N=Object.assign($,{__name:"Products",setup(s){return(t,a)=>(f(),m(h,null,{default:p(()=>[e("div",C,[e("div",y,[E,e("div",I,[e("button",{class:"btn btn-outline-success",onClick:a[0]||(a[0]=(...o)=>t.showAddDialog&&t.showAddDialog(...o))},[n(" Add"),M])])]),i(e("div",null,[e("div",O,[n(g(t.loadingmsg)+" ",1),j])],512),[[d,t.loadingmsg]]),i(e("div",null,[l(P,{msg:t.alertmsg,mode:t.alertmode},null,8,["msg","mode"]),e("form",T,[i(e("input",{class:"form-control me-2","onUpdate:modelValue":a[1]||(a[1]=o=>t.searchword=o),type:"search",placeholder:"Search","aria-label":"Search"},null,512),[[b,t.searchword]]),e("button",{class:"btn btn-outline-success",type:"submit",onClick:a[2]||(a[2]=(...o)=>t.loadProducts&&t.loadProducts(...o))},"Search")]),l(v,{items:t.items,columns:t.fields,allowaction:t.allowRowAction,actionmapper:t.actionMapper,actionmapperidentifier:"id",onDisableItem:t.disableProduct,onEnableItem:t.enableProduct,onEditClick:t.showEditDialog},null,8,["items","columns","allowaction","actionmapper","onDisableItem","onEnableItem","onEditClick"])],512),[[d,!t.loadingmsg]])]),l(S,{show:t.showDialog,fields:t.fields,title:t.dialogTitle,actualobj:t.selectedObject,onSave:t.performSave,onCancel:a[3]||(a[3]=o=>t.showDialog=!1),dao:w(u)},null,8,["show","fields","title","actualobj","onSave","dao"])]),_:1}))}});export{N as default};
