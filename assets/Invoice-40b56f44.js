import{w as n,v as C,o as m,c as u,F as k,r as P,t as f,a as w,b as t,p as A,C as l,A as c,d as I,e as p,f as v,g,h as D,i as y,_ as $,s as N,S as O,j as T,I as V,k as E,l as a,u as U}from"./index-ada051fb.js";import{_ as M}from"./InvoiceItemTable-81f08cd6.js";import{_ as b}from"./CAlert-4ed3b38a.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as L}from"./CustomerPicker-f9cf5b87.js";const j=t("option",{value:"0"},"Select an item",-1),F=["value"],G={props:["seleceted","show"],emits:["selected"],data:function(){return{products:[],items:[],placeholder:"Select a product",selectedproduct:null}},mounted:function(){this.loadProducts()},watch:{show:function(){this.show||(this.selectedproduct=0)},selectedproduct:function(){this.show&&this.itemSelected&&this.itemSelected(this.selectedproduct)}},methods:{loadProducts:function(){var s=this;A.list().then(e=>{s.products=e,s.items=_.map(e,function(o){return{id:o.id,text:o.Name}})})},itemSelected:function(s){if(!s){this.$emit("selected",{});return}var e=_.find(this.products,function(o){return o.id==s});console.log(s,e),this.$emit("selected",e)}}},q=Object.assign(G,{__name:"ProductPicker",setup(s){return(e,o)=>e.items?n((m(),u("select",{key:0,class:"form-control","onUpdate:modelValue":o[0]||(o[0]=r=>e.selectedproduct=r)},[j,(m(!0),u(k,null,P(e.items,r=>(m(),u("option",{value:r.id},f(r.text),9,F))),256))],512)),[[C,e.selectedproduct]]):w("",!0)}}),W={props:["show","item"],emits:["cancel","save"],data:function(){return{lockprice:!1,alertmode:"",alertmsg:""}},watch:{show:function(s){this.alertmode=this.alertmsg=""}},methods:{performClose:function(s){s&&s.preventDefault(),this.$emit("cancel")},performSave:function(s){s&&s.preventDefault();var e=this;if(this.alertmode=this.alertmsg="",!this.item||!this.item.productId){l.showAlert(e,"Select an item",c.ERROR);return}if(!this.item.making||this.item.making<=0){l.showAlert(e,"Invalid making",c.ERROR);return}if(!this.item.weight||this.item.weight<=0){l.showAlert(e,"Invalid weight",c.ERROR);return}if(!this.item.purity||this.item.purity<=0){l.showAlert(e,"Invalid purity",c.ERROR);return}this.$emit("save",this.item)},itemPicked:function(s){this.item.productId=s.id,this.item.name=s.Name,this.item.making=s["Making Amount"]}},components:{ProductPicker:q,CAlert:b}},z={class:"modal show",style:{display:"block"}},H={key:0,class:"modal-dialog"},J={class:"modal-content"},K={class:"modal-header"},Q=t("h5",{class:"modal-title",id:"staticBackdropLabel"},"Details",-1),X={class:"modal-body"},Y={class:"mb-3",style:{overflow:"visible"}},Z=t("label",{for:"exampleInputPassword1",class:"form-label"},"Item",-1),x={class:"mb-3"},ee=t("label",{for:"exampleInputPassword1",class:"form-label"},"Weight",-1),te={class:"mb-3"},se=t("label",{for:"exampleInputPassword1",class:"form-label"},"Purity",-1),oe={class:"mb-3"},ie=t("label",{for:"exampleInputPassword1",class:"form-label"},"Making/Gram",-1),ne={class:"modal-footer"},le={key:0,class:"modal-backdrop show"};function ae(s,e,o,r,d,h){const R=I("CAlert"),S=I("ProductPicker");return m(),u(k,null,[n(t("div",null,[t("div",z,[o.item?(m(),u("div",H,[t("div",J,[t("div",K,[Q,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[0]||(e[0]=(...i)=>h.performClose&&h.performClose(...i))})]),t("div",X,[v(R,{msg:s.alertmsg,mode:s.alertmode},null,8,["msg","mode"]),t("form",null,[t("div",Y,[Z,v(S,{onSelected:h.itemPicked,show:o.show},null,8,["onSelected","show"])]),t("div",x,[ee,n(t("input",{type:"number","onUpdate:modelValue":e[1]||(e[1]=i=>o.item.weight=i),class:"form-control"},null,512),[[g,o.item.weight]])]),t("div",te,[se,n(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=i=>o.item.purity=i),class:"form-control"},null,512),[[g,o.item.purity]])]),t("div",oe,[ie,n(t("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=i=>o.item.making=i),class:"form-control"},null,512),[[g,o.item.making]])])])]),t("div",ne,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=(...i)=>h.performClose&&h.performClose(...i))},"Close"),t("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=(...i)=>h.performSave&&h.performSave(...i))},"Save")])])])):w("",!0)])],512),[[p,o.show]]),o.show?(m(),u("div",le)):w("",!0)],64)}const re=B(W,[["render",ae]]),de={class:"text-center"},ce=t("div",{class:"spinner-grow",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),me={key:0},ue={class:"pricing-header p-3 pb-md-4 mx-auto text-start"},he={class:"row"},fe={class:"col col-5"},ve={class:"display-10 fw-normal"},pe=t("div",{class:"col"},null,-1),_e={class:"col"},ge={class:"display-10 fw-normal"},we={class:"display-10 fw-normal"},Ie={class:"col"},be={class:"display-10 fw-normal"},ye={class:"display-10 fw-normal"},ke=t("hr",null,null,-1),Re={class:"row"},Se={class:"col"},Ce={class:"mb-3 row"},Pe=t("label",{for:"staticEmail",class:"col-sm-2 col-form-label"},"Customer",-1),Ae={class:"col-sm-10"},De={class:"col"},$e={class:"d-grid gap-2 d-md-flex justify-content-md-end"},Ne=t("span",{class:"material-icons"},"save",-1),Oe={class:"d-grid gap-2 d-md-flex justify-content-md-end"},Te=t("span",{class:"material-icons"},"add",-1),Ve={key:1,class:"text-center p-5"},Ee={data:function(){return{showpicker:!1,currentItem:null,fractionDigits:3,invoiceInfo:{items:[],rate:123,customer:"Sample Customer",purchaseDate:"2023-04-27",invoiceNumber:"inv-123",vat:5},totals:[],updatecount:0,settings:{},alertmode:"",alertmsg:"",loadingmsg:"",totals:{},currentRate:null}},mounted:function(){this.loadInitialValues()},methods:{logTotals:function(s){this.totals=s},loadInitialValues:function(){var s=this;N.getById(O.APPLICATION_SETTINGS).then(e=>{s.settings=e}),T.getTodaysRate().then(e=>{s.currentRate=e,s.invoiceInfo={items:[],rate:e,customer:"",purchaseDate:l.getNowAsMilliSeconds(),invoiceNumber:V.generateInvoiceNumber(),vat:s.settings.vat??5,totals:{}},s.updatecount=0})},showItemPicker:function(){this.currentItem={},this.showpicker=!0},itemSelected:function(s){this.invoiceInfo.items.push(s),this.updatecount+=1,this.showpicker=!1},saveInvoice:function(s){s&&s.preventDefault();var e=this;if(!e.invoiceInfo.purchaseDate||!e.invoiceInfo.rate){l.showAlert(e,"Purchase date and rate should be specified on history mode",c.ERROR);return}if(!this.invoiceInfo.customer){l.showAlert(e,"Customer info required.",c.ERROR);return}if(!this.invoiceInfo.items||this.invoiceInfo.items.length==0){l.showAlert(e,"Minimum of 1 item required.",c.ERROR);return}const o={...this.invoiceInfo};o.totals=this.totals,E.addOrUpdate(o).then(()=>{l.showAlert(e,"Invoice saved",c.SUCCESS),e.loadInitialValues(),e.showInvoiceToPrint(o.invoiceNumber)}).catch(r=>{console.log(r),l.showAlert(e,"Could not save the invoice.",c.ERROR)}).finally(()=>{e.loadingmsg=""})},deleteItem:function(s){this.invoiceInfo.items=_.filter(this.invoiceInfo.items,function(e){return e!=s}),this.updatecount+=1},customerSelected:function(s){this.invoiceInfo.customer=s.Name,this.invoiceInfo.customerId=s.id},showInvoiceToPrint(s){var e=this.$basedomainname+"invoices/"+s;window.open(e,"_blank")}},components:{CAlert:b}},Fe=Object.assign(Ee,{__name:"Invoice",setup(s){return(e,o)=>{const r=I("RouterLink");return m(),D($,null,{default:y(()=>[n(t("div",null,[t("div",de,[a(f(e.loadingmsg)+" ",1),ce])],512),[[p,e.loadingmsg]]),n(t("div",null,[e.currentRate?(m(),u("div",me,[t("div",ue,[t("div",he,[t("div",fe,[t("h3",ve,"Invoice : "+f(e.invoiceInfo.invoiceNumber),1)]),pe,n(t("div",_e,[t("h3",ge,[a("Date : "),t("span",null,f(U(l).getAsFormattedDate(e.invoiceInfo.purchaseDate)),1)]),t("h3",we,"Rate : "+f(e.invoiceInfo.rate)+" "+f(e.settings.currency),1)],512),[[p,e.settings.historymode!="yes"]]),n(t("div",Ie,[t("h3",be,[a("Date : "),n(t("input",{type:"datetime-local","onUpdate:modelValue":o[0]||(o[0]=d=>e.invoiceInfo.purchaseDate=d),style:{width:"300px"}},null,512),[[p,e.settings.historymode=="yes"],[g,e.invoiceInfo.purchaseDate]])]),t("h3",ye,[a("Rate : "),n(t("input",{type:"number","onUpdate:modelValue":o[1]||(o[1]=d=>e.invoiceInfo.rate=d),style:{width:"100px"}},null,512),[[g,e.invoiceInfo.rate]]),a(" "+f(e.settings.currency),1)])],512),[[p,e.settings.historymode=="yes"]])]),ke,v(b,{msg:e.alertmsg,mode:e.alertmode},null,8,["msg","mode"]),t("div",Re,[t("div",Se,[t("div",Ce,[Pe,t("div",Ae,[v(L,{onSelected:e.customerSelected},null,8,["onSelected"])])])]),t("div",De,[t("div",$e,[t("button",{class:"btn btn-outline-success",onClick:o[2]||(o[2]=(...d)=>e.saveInvoice&&e.saveInvoice(...d))},[a("Save Invoice"),Ne])])]),t("div",Oe,[t("button",{class:"btn btn-outline-success",onClick:o[3]||(o[3]=(...d)=>e.showItemPicker&&e.showItemPicker(...d))},[a("Add"),Te])])])]),v(M,{invoiceinfo:e.invoiceInfo,fraction_digits:e.fractionDigits,allowdelete:"true",updatecount:e.updatecount,onRowdelete:e.deleteItem,onTotals:e.logTotals},null,8,["invoiceinfo","fraction_digits","updatecount","onRowdelete","onTotals"]),v(re,{show:e.showpicker,item:e.currentItem,onCancel:o[4]||(o[4]=d=>e.showpicker=!1),onSave:e.itemSelected},null,8,["show","item","onSave"])])):(m(),u("div",Ve,[a(" No rate available for the Today. Please "),v(r,{to:"/rates"},{default:y(()=>[a("set the rate")]),_:1}),a(" . ")]))],512),[[p,!e.loadingmsg]])]),_:1})}}});export{Fe as default};
