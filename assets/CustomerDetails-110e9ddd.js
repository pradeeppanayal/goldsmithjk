import{o as l,h as p,i as A,j as k,l as w,A as m,y,z as D,n as b,b as e,f as h,c as d,r as I,F as N,w as c,e as u,a as g,u as r,D as f,t as n,m as i,C as v,B as L}from"./index-00e45d0b.js";import{_ as O}from"./CAlert-b221f23b.js";import{_ as R}from"./TwoColumnTable-ac4a3f17.js";import{_ as C}from"./DynamicTable-62835890.js";const S={class:"pricing-header p-3 pb-md-4 mx-auto"},B=e("div",{class:"row"},[e("div",{class:"col"},[e("div",{class:"mb-3 row text-start"},[e("div",{class:"col-sm-10"},[e("span",{class:"display-6 fw-normal"},"Customer Details")])])])],-1),G={class:"nav nav-tabs"},M={class:"nav-item"},U=["onClick"],E=e("br",null,null,-1),V={class:"tab-content"},F={key:0,class:"row"},$={class:"col text-start"},P={class:"col"},W={class:"col"},j={key:0,class:"row"},z={class:"col text-start"},H={class:"col"},q={key:0,class:"row"},J={class:"col text-start"},K={class:"col"},Q={class:"text-center"},X=e("div",{class:"spinner-grow",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),Y={data:function(){return{currentUserId:null,alertmode:"",alertmsg:"",loadingmsg:"",formattedCustomerDetails:null,selectedmenuitem:"details",tabs:[{title:"Details",identifier:"details"},{title:"Invoices",identifier:"invoices"},{title:"Gold Transactions",identifier:"gold"},{title:"Cash Transactions",identifier:"cash"}],invoices:null,actions:[{identifier:"viewClick",materialicon:"print",title:"View and Print Invoice"}],goldTransactions:null,cashTransactions:null,totals:{},actionMapper:[]}},mounted:function(){this.currentUserId=this.$route.params.customerid,this.checkAndLoadInfo()},methods:{getTotal:function(t,s){return t.reduce((o,a)=>o+a[s],0)},showTab:function(t,s){t&&t.preventDefault(),this.selectedmenuitem=s,this.selectedmenuitem=="invoices"&&this.checkAndLoadInvoices(),this.selectedmenuitem=="cash"&&this.checkAndLoadCashTransactions(),this.selectedmenuitem=="gold"&&this.checkAndLoadGoldTransactions()},checkAndLoadInvoices:function(){if(!this.invoices){var t=this,s={};t.loadingmsg="Loading invoices...",t.totals={weight:0,amount:0},w.listByCustomer(t.currentUserId).then(o=>{_.each(o,function(a){s[a.invoiceNumber]=t.actions,a.products=a.items.length,a.weight=a.totals?a.totals.weight:0,a.amount=a.totals?a.totals.totalAmount:0,a.weight&&a.amount&&(t.totals.weight+=a.weight,t.totals.amount+=a.amount)}),t.actionMapper=s,t.invoices=o}).catch(o=>{console.log(o),t.alertmode=m.ERROR,t.alertmsg="Could not load the invoices "}).finally(()=>{t.loadingmsg=""})}},showInvoiceReport:function(t){var s=this.$basedomainname+"invoices/"+t.invoiceNumber;window.open(s,"_blank")},checkAndLoadCashTransactions:function(){if(!this.cashTransactions){var t=this;t.loadingmsg="Loading cash transactions...",y.listByCustomer(this.currentUserId).then(s=>t.cashTransactions=s).catch(s=>{console.log(s),t.alertmode=m.ERROR,t.alertmsg="Could not load the cash transactions "}).finally(()=>{t.loadingmsg=""})}},checkAndLoadGoldTransactions:function(){if(!this.goldTransactions){var t=this;t.loadingmsg="Loading gold transactions...",D.listByCustomer(this.currentUserId).then(s=>{_.each(s,o=>o.pureWeight=o.weight*o.purity*.001),t.goldTransactions=s}).catch(s=>{console.log(s),t.alertmode=m.ERROR,t.alertmsg="Could not load the gold transactions "}).finally(()=>{t.loadingmsg=""})}},checkAndLoadInfo:function(){var t=this;b.getById(this.currentUserId).then(s=>{t.formatCustomerDeatils(s)}).catch(s=>{console.log(s),t.alertmode=m.ERROR,t.alertmsg="Could not load the customers"}).finally(()=>{t.loadingmsg=""})},formatCustomerDeatils:function(t){var s={};s=[{key:"Name",value:t.Name},{key:"Contact",value:t.Contact},{key:"Address",value:t.Address},{key:"Status",value:t.status},{key:"CashCredit",value:t.CashCredit},{key:"CashDebit",value:t.CashDebit},{key:"Cash Balance",value:Math.round(((t.CashCredit??0)-(t.CashDebit??0)+Number.EPSILON)*100)/100},{key:"GoldCredit",value:t.GoldCredit},{key:"GoldDebit",value:t.GoldDebit},{key:"Gold Balance",value:Math.round(((t.GoldCredit??0)-(t.GoldDebit??0)+Number.EPSILON)*100)/100}],this.formattedCustomerDetails=s}}},es=Object.assign(Y,{__name:"CustomerDetails",setup(t){return(s,o)=>(l(),p(k,null,{default:A(()=>[e("div",S,[B,e("div",null,[h(O,{msg:s.alertmsg,mode:s.alertmode},null,8,["msg","mode"]),e("ul",G,[(l(!0),d(N,null,I(s.tabs,a=>(l(),d("li",M,[e("a",{class:L(["nav-link",s.selectedmenuitem==a.identifier?"active":""]),onClick:T=>s.showTab(T,a.identifier),"aria-current":"page",href:"#"},n(a.title),11,U)]))),256))])]),E,e("div",V,[c(e("div",null,[s.formattedCustomerDetails?(l(),p(R,{key:0,items:s.formattedCustomerDetails},null,8,["items"])):g("",!0)],512),[[u,!s.loadingmsg&&s.selectedmenuitem=="details"]]),c(e("div",null,[h(C,{onViewClick:s.showInvoiceReport,items:s.invoices,columns:r(f).INVOICES_COLUMNS,allowaction:"true",actionmapper:s.actionMapper,actionmapperidentifier:"invoiceNumber"},null,8,["onViewClick","items","columns","actionmapper"]),s.invoices&&s.invoices.length>0?(l(),d("div",F,[e("div",$,[e("strong",null,n(s.invoices.length),1),i(" record(s).")]),e("div",P,[i("Total Weight:"),e("strong",null,n(r(v).getAsFormattedAmount(s.totals.weight)),1)]),e("div",W,[i("Total Amount: "),e("strong",null,n(r(v).getAsFormattedAmount(s.totals.amount)),1)])])):g("",!0)],512),[[u,!s.loadingmsg&&s.selectedmenuitem=="invoices"]]),c(e("div",null,[h(C,{items:s.cashTransactions,columns:r(f).CASH_TRANSACTION_COLUMNS},null,8,["items","columns"]),s.cashTransactions&&s.cashTransactions.length>0?(l(),d("div",j,[e("div",z,[e("strong",null,n(s.cashTransactions.length),1),i(" record(s).")]),e("div",H,[i("Total Amount: "),e("strong",null,n(r(v).getAsFormattedAmount(s.getTotal(s.cashTransactions,"amount"))),1)])])):g("",!0)],512),[[u,!s.loadingmsg&&s.selectedmenuitem=="cash"&&s.cashTransactions]]),c(e("div",null,[h(C,{items:s.goldTransactions,columns:r(f).GOLD_TRANSACTION_COLUMNS},null,8,["items","columns"]),s.goldTransactions&&s.goldTransactions.length>0?(l(),d("div",q,[e("div",J,[e("strong",null,n(s.goldTransactions.length),1),i(" record(s).")]),e("div",K,[i("Total Amount: "),e("strong",null,n(r(v).getAsFormattedAmount(s.getTotal(s.goldTransactions,"pureWeight"))),1)])])):g("",!0)],512),[[u,!s.loadingmsg&&s.selectedmenuitem=="gold"&&s.goldTransactions]]),c(e("div",null,[e("div",Q,[i(n(s.loadingmsg)+" ",1),X])],512),[[u,s.loadingmsg]])])])]),_:1}))}});export{es as default};
