import{_ as h,o as n,c as b,h as f,i as g,f as d,A as v,a as t,e as l,w as c,g as m,d as y,t as S}from"./index-a9977b16.js";import{c as C,C as u,I as D,a as N}from"./dao-0a59864c.js";import{_ as p}from"./CAlert-49effe02.js";import{A as i}from"./ApplicationConstants-909446ca.js";const R={props:["selected","readonly","items","placeholder"],emits:["selected"],data:function(){return{ready:!1,ref_id:"sel2"}},mounted:function(){},watch:{items:function(){var s=this;s.items&&($(this.$refs[this.ref_id]).select2({placeholder:{id:"",text:s.placeholder??"Select an item"},data:s.items}),$(this.$refs[this.ref_id]).on("select2:select",function(e){s.$emit("selected",e.params.data.id)}),$(this.$refs[this.ref_id]).val(this.selected),$(this.$refs[this.ref_id]).trigger("change"),this.ready=!0)},selected:function(){this.ready&&($(this.$refs[this.ref_id]).val(this.selected),$(this.$refs[this.ref_id]).trigger("change"))}}},A=["disabled"];function k(s,e,o,r,a,W){return n(),b("select",{ref:s.ref_id,class:"form-control",disabled:o.readonly},null,8,A)}const w=h(R,[["render",k]]),I={props:["seleceted"],emits:["selected"],data:function(){return{customers:[],items:[],placeholder:"Select a customer"}},mounted:function(){this.loadCustomers()},methods:{loadCustomers:function(){var s=this;C.list().then(e=>{s.customers=e,s.items=_.map(e,function(o){return{id:o.id,text:o.Name}})})},itemSelected:function(s){var e=_.find(this.customers,function(o){return o.id==s});this.$emit("selected",e)}}},O=Object.assign(I,{__name:"CustomerPicker",setup(s){return(e,o)=>(n(),f(w,{ref_id:"customer",items:e.items,selected:s.seleceted,onSelected:e.itemSelected,placeholder:e.placeholder},null,8,["items","selected","onSelected","placeholder"]))}}),V={class:"pricing-header p-3 pb-md-4 mx-auto text-center"},B=t("div",{class:"row"},[t("div",{class:"col"},[t("div",{class:"mb-3 row text-start"},[t("div",{class:"col-sm-10"},[t("span",{class:"display-6 fw-normal"},"Payment")])])]),t("div",{class:"col text-end"})],-1),E=t("hr",null,null,-1),P={class:"form-floating mb-3"},U=["value"],x=t("label",{for:"recNumber",class:"col-sm-2 col-form-label"},"Receipt Number",-1),F={class:"form-floating mb-3"},M=["value"],T=t("label",{for:"paymentdate",class:"col-sm-2 col-form-label"},"Date",-1),j={class:"form-floating mb-3"},G=t("label",{for:"amount",class:"col-sm-2 col-form-label"},"Amount",-1),L={class:"mb-3 text-start"},q=t("label",{for:"customer",class:"col-sm-2 col-form-label"},"Customer",-1),z={class:"form-floating mb-3"},H=t("label",{for:"description",class:"col-sm-2 col-form-label"},"Description",-1),J={class:"text-end p-3"},K=["disabled"],Q={data:function(){return{item:{receiptNumber:"",paymentDate:"",customer:"",description:"",amount:0},loading:!1,alertmsg:"",alertmode:""}},mounted:function(){this.loadInitialVals()},methods:{loadInitialVals:function(){this.item={paymentDate:u.getNowAsMilliSeconds(),receiptNumber:D.generateReceiptNumber(),amount:0,description:""}},getAsFormattedDate:function(s){return u.getAsFormattedDate(s)},performSave:function(s){if(s&&s.preventDefault(),!this.item.amount||this.amount<=0){this.alertmode=i.ERROR,this.alertmsg="Invalid amount";return}if(!this.item.customerId){this.alertmode=i.ERROR,this.alertmsg="Customet info required";return}this.loading=!0;var e=this;N.addOrUpdate(this.item).then(()=>{e.alertmode=i.SUCCESS,e.alertmsg="Payment saved.",e.loadInitialVals()}).catch(o=>{console.log(o),e.alertmode=i.ERROR,e.alertmsg="Could save the payment info"}).finally(()=>{e.loading=!1})},customerSelected:function(s){this.item.customer=s.Name,this.item.customerId=s.id}},components:{CAlert:p}},te=Object.assign(Q,{__name:"Payment",setup(s){return(e,o)=>{const r=g("RouterLink");return n(),f(v,null,{default:d(()=>[t("div",V,[B,E,l(p,{msg:e.alertmsg,mode:e.alertmode},null,8,["msg","mode"]),t("form",null,[t("div",P,[t("input",{type:"text",id:"recNumber",class:"form-control-plaintext",readonly:"",value:e.item.receiptNumber},null,8,U),x]),t("div",F,[t("input",{type:"text",id:"paymentdate",class:"form-control-plaintext",readonly:"",value:e.getAsFormattedDate(e.item.paymentDate)},null,8,M),T]),t("div",j,[c(t("input",{type:"number",id:"amount","onUpdate:modelValue":o[0]||(o[0]=a=>e.item.amount=a),class:"form-control"},null,512),[[m,e.item.amount]]),G]),t("div",L,[q,l(O,{id:"customer",onSelected:e.customerSelected},null,8,["onSelected"])]),t("div",z,[c(t("textarea",{type:"text",id:"description","onUpdate:modelValue":o[1]||(o[1]=a=>e.item.description=a),class:"form-control"},null,512),[[m,e.item.description]]),H])]),t("div",J,[l(r,{to:"/payments",class:"btn btn-secondary",title:"Go back to payments"},{default:d(()=>[y("Back")]),_:1}),t("button",{type:"button",class:"btn btn-primary left-spaced",onClick:o[2]||(o[2]=(...a)=>e.performSave&&e.performSave(...a)),disabled:e.loading},S(e.loading?"Saving...":"Save"),9,K)])])]),_:1})}}});export{te as default};
