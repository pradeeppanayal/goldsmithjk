import{C as n,A as i,j as v,d as R,o as m,c as u,w as d,e as f,b as t,f as r,g as w,t as h,a as C,F as p,i as S,_ as D,l as g}from"./index-ada051fb.js";import{_ as A}from"./DynamicTable-85da96c9.js";import{_ as b}from"./CAlert-4ed3b38a.js";import{_ as k}from"./_plugin-vue_export-helper-c27b6911.js";const $={props:["show","currentrate"],emits:["cancel","save"],data:function(){return{rate:0,lockprice:!1,currentdate:"",loading:!1,alertmsg:"",alertmode:""}},mounted:function(){this.currentdate=n.getTodayAsString()},watch:{currentrate:function(s){this.rate=this.currentrate??0},show:function(){this.rate=this.currentrate??0}},methods:{performClose:function(s){s&&s.preventDefault(),!this.loading&&this.$emit("cancel")},performSave:function(s){s&&s.preventDefault();var e=this;if(this.loading)return;if(!this.rate||this.rate<=0){n.showAlert(e,"Invalid or no rate provided.",i.ERROR);return}this.loading=!0;const a={rate:this.rate};v.addOrUpdate(a).then(()=>{e.$emit("save",a)}).catch(c=>{console.log(c),n.showAlert(e,"Could not save the rate.",i.ERROR)}).finally(()=>e.loading=!1)}},components:{CAlert:b}},T={class:"modal show",style:{display:"block"}},O={class:"modal-dialog"},E={class:"modal-content"},N={class:"modal-header"},V=t("h5",{class:"modal-title",id:"staticBackdropLabel"},"Today's Rate",-1),B={class:"modal-body"},U={class:"form-floating mb-3"},F=["value"],I=t("label",{for:"date",class:"form-label"},"Date",-1),j={class:"form-floating mb-3"},L=t("label",{for:"rate",class:"form-label"},"Rate",-1),M={class:"modal-footer"},z=["disabled"],H=["disabled"],q={key:0,class:"modal-backdrop show"};function G(s,e,a,c,ee,l){const y=R("CAlert");return m(),u(p,null,[d(t("div",null,[t("div",T,[t("div",O,[t("div",E,[t("div",N,[V,t("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:e[0]||(e[0]=(...o)=>l.performClose&&l.performClose(...o))})]),t("div",B,[r(y,{msg:s.alertmsg,mode:s.alertmode},null,8,["msg","mode"]),t("form",null,[t("div",U,[t("input",{type:"text",id:"date",class:"form-control-plaintext",readonly:"",value:s.currentdate},null,8,F),I]),t("div",j,[d(t("input",{type:"number",id:"rate","onUpdate:modelValue":e[1]||(e[1]=o=>s.rate=o),class:"form-control"},null,512),[[w,s.rate]]),L])])]),t("div",M,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[2]||(e[2]=(...o)=>l.performClose&&l.performClose(...o)),disabled:s.loading},"Close",8,z),t("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=(...o)=>l.performSave&&l.performSave(...o)),disabled:s.loading},h(s.loading?"Saving...":"Save"),9,H)])])])])],512),[[f,a.show]]),a.show?(m(),u("div",q)):C("",!0)],64)}const J=k($,[["render",G]]),K={class:"text-center"},P=t("div",{class:"spinner-grow",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),Q={class:"pricing-header p-3 pb-md-4 mx-auto text-center"},W={class:"display-3 fw-normal"},X=t("hr",null,null,-1),Y=t("h1",{class:"display-6 fw-normal"},"History",-1),Z=t("hr",null,null,-1),x={data:function(){return{showRateSetDialog:!1,items:[],columns:[{name:"date",show:!0},{name:"rate",show:!0}],todaysRate:"NA",currentDate:null,loadingmsg:"",alertmsg:"",alertmode:""}},mounted:function(){this.loadRates()},methods:{loadRates:function(){this.loadingmsg="Fetching rates...",this.refreshRates()},closeDialog:function(){this.showRateSetDialog=!1},loadTodaysIfAvailable:function(){this.todaysRate="";var s=n.getTodayAsString(),e=_.find(this.items,function(a){return a.date==s});e&&e.rate&&(this.todaysRate=e.rate)},refreshRates:function(){var s=this;v.list().then(e=>{s.items=e,s.loadTodaysIfAvailable()}).catch(e=>{console.log(e),n.showAlert(s,"Could not fetch the rates.",i.ERROR)}).finally(()=>s.loadingmsg="")},performSave:function(s){var e=this;n.showAlert(e,"Rate changes saved.",i.SUCCESS),e.closeDialog(),e.refreshRates()}}},le=Object.assign(x,{__name:"Rates",setup(s){return(e,a)=>(m(),u(p,null,[r(D,null,{default:S(()=>[d(t("div",null,[t("div",K,[g(h(e.loadingmsg)+" ",1),P])],512),[[f,e.loadingmsg]]),d(t("div",Q,[r(b,{msg:e.alertmsg,mode:e.alertmode},null,8,["msg","mode"]),t("h1",W,[g("Today's Rate : "+h(e.todaysRate??"--")+" ",1),t("span",{onClick:a[0]||(a[0]=c=>e.showRateSetDialog=!0),class:"material-icons btn",title:"Set today's rate",style:{"font-size":"3rem"}},"edit")]),X,Y,Z,r(A,{items:e.items,columns:e.columns},null,8,["items","columns"])],512),[[f,!e.loadingmsg]])]),_:1}),r(J,{show:e.showRateSetDialog,currentrate:e.todaysRate,onCancel:e.closeDialog,onSave:e.performSave},null,8,["show","currentrate","onCancel","onSave"])],64))}});export{le as default};
