import{o as m,h as p,i as f,A as h,b as s,j as r,w as i,e as c,t as g,f as l,g as b}from"./index-8a337015.js";import{_ as v}from"./DynamicTable-f7ec0263.js";import{D as w}from"./DynamicDialog-1aa5fbce.js";import{s as D,p as u}from"./dao-0a59864c.js";import{_ as S}from"./CAlert-8d6317ac.js";import{S as A,A as n}from"./ApplicationConstants-909446ca.js";const C={class:"pricing-header p-3 pb-md-4 mx-auto"},P={class:"row"},E=s("div",{class:"col"},[s("div",{class:"mb-3 row text-start"},[s("div",{class:"col-sm-10"},[s("span",{class:"display-6 fw-normal"},"Products")])])],-1),y={class:"col text-end"},I=s("span",{class:"material-icons"},"add",-1),M={class:"text-center"},O=s("div",{class:"spinner-grow",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),R={class:"d-flex d-flex p-3 border-top"},j={data:function(){return{showDialog:!1,selectedObject:null,dialogTitle:"Product info",items:[],fields:[],allowRowAction:!0,actionMapper:{},alertmode:"",alertmsg:"",loadingmsg:"",searchword:""}},mounted:function(){this.loadFields(),this.loadProducts()},methods:{loadFields:function(){var e=this;D.getById(A.PRODUCT_SETTINGS).then(t=>{e.fields=t.fields??[]})},getActionsItems:function(e){var t=[{identifier:"editClick",materialicon:"edit",title:"Edit"}];return e.status==this.$statusLabelMapper.enabled&&t.push({identifier:"disableItem",materialicon:"visibility_off",title:"Disable"}),e.status==this.$statusLabelMapper.disabled&&t.push({identifier:"enableItem",materialicon:"visibility",title:"Enable"}),t},loadProducts:function(e){e&&e.preventDefault();var t=this,a={};t.loadingmsg="Fetching products...",u.list(t.searchword).then(o=>{_.each(o,function(d){a[d.id]=t.getActionsItems(d)}),t.items=o,t.actionMapper=a}).catch(o=>{console.log(o),t.alertmode=n.ERROR,t.alertmsg="Could not load the products"}).finally(()=>{t.loadingmsg=""})},enableProduct:function(e){this.updateStatus(e,this.$statusLabelMapper.enabled)},disableProduct:function(e){this.updateStatus(e,this.$statusLabelMapper.disabled)},updateStatus:function(e,t){e.status=t,this.performSave(e)},showEditDialog:function(e){this.selectedObject=e,this.showDialog=!0},showAddDialog:function(e){e&&e.preventDefault(),this.selectedObject=null,this.showDialog=!0},performSave:function(e){e.status=e.status??this.$statusLabelMapper.enabled;var t=this;t.showDialog=!1,t.loadingmsg="Saving customer info...",u.addOrUpdate(e).then(()=>{t.alertmode=n.SUCCESS,t.alertmsg="Changes saved",t.loadProducts()}).catch(a=>{console.log(a),t.alertmode=n.ERROR,t.alertmsg="Could not save the changes"}).finally(()=>{t.loadingmsg=""})}}},U=Object.assign(j,{__name:"Products",setup(e){return(t,a)=>(m(),p(h,null,{default:f(()=>[s("div",C,[s("div",P,[E,s("div",y,[s("button",{class:"btn btn-outline-success",onClick:a[0]||(a[0]=(...o)=>t.showAddDialog&&t.showAddDialog(...o))},[r(" Add"),I])])]),i(s("div",null,[s("div",M,[r(g(t.loadingmsg)+" ",1),O])],512),[[c,t.loadingmsg]]),i(s("div",null,[l(S,{msg:t.alertmsg,mode:t.alertmode},null,8,["msg","mode"]),s("form",R,[i(s("input",{class:"form-control me-2","onUpdate:modelValue":a[1]||(a[1]=o=>t.searchword=o),type:"search",placeholder:"Search","aria-label":"Search"},null,512),[[b,t.searchword]]),s("button",{class:"btn btn-outline-success",type:"submit",onClick:a[2]||(a[2]=(...o)=>t.loadProducts&&t.loadProducts(...o))},"Search")]),l(v,{items:t.items,columns:t.fields,allowaction:t.allowRowAction,actionmapper:t.actionMapper,actionmapperidentifier:"id",onDisableItem:t.disableProduct,onEnableItem:t.enableProduct,onEditClick:t.showEditDialog},null,8,["items","columns","allowaction","actionmapper","onDisableItem","onEnableItem","onEditClick"])],512),[[c,!t.loadingmsg]])]),l(w,{show:t.showDialog,fields:t.fields,title:t.dialogTitle,actualobj:t.selectedObject,onSave:t.performSave,onCancel:a[3]||(a[3]=o=>t.showDialog=!1)},null,8,["show","fields","title","actualobj","onSave"])]),_:1}))}});export{U as default};
